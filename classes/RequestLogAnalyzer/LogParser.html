<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: RequestLogAnalyzer::LogParser</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">RequestLogAnalyzer::LogParser</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../files/lib/request_log_analyzer/log_parser_rb.html">
                lib/request_log_analyzer/log_parser.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
The <a href="LogParser.html">LogParser</a> class reads log data from a
given source and uses a file format definition to parse all relevent
information about requests from the file. A <a
href="FileFormat.html">FileFormat</a> module should be provided that
contains the definitions of the lines that occur in the log data.
</p>
<p>
De order in which lines occur is used to combine lines to a single request.
If these lines are mixed, requests cannot be combined properly. This can be
the case if data is written to the log file simultaneously by different
mongrel processes. This problem is detected by the parser, but the requests
that are mixed up cannot be parsed. It will emit warnings when this occurs.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000145">footer_line?</a>&nbsp;&nbsp;
      <a href="#M000143">handle_request</a>&nbsp;&nbsp;
      <a href="#M000144">header_line?</a>&nbsp;&nbsp;
      <a href="#M000134">new</a>&nbsp;&nbsp;
      <a href="#M000136">parse_file</a>&nbsp;&nbsp;
      <a href="#M000135">parse_files</a>&nbsp;&nbsp;
      <a href="#M000138">parse_io</a>&nbsp;&nbsp;
      <a href="#M000137">parse_stream</a>&nbsp;&nbsp;
      <a href="#M000139">progress=</a>&nbsp;&nbsp;
      <a href="#M000142">update_current_request</a>&nbsp;&nbsp;
      <a href="#M000141">warn</a>&nbsp;&nbsp;
      <a href="#M000140">warning=</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->
    <div id="includes">
      <h3 class="section-bar">Included Modules</h3>

      <div id="includes-list">
        <span class="include-name">RequestLogAnalyzer::FileFormat::Awareness</span>
      </div>
    </div>

    <div id="section">





    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">current_request</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
The current <a href="Request.html">Request</a> object that is being parsed

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">options</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
A hash of options

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">parsed_lines</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
The total number of parsed lines

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">parsed_requests</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
The total number of parsed requests.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">skipped_requests</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
The number of skipped requests because of date constraints

</td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000134" class="method-detail">
        <a name="M000134"></a>

        <div class="method-heading">
          <a href="#M000134" class="method-signature">
          <span class="method-name">new</span><span class="method-args">(format, options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Initializes the parser instance. It will apply the language specific <a
href="FileFormat.html">FileFormat</a> module to this instance. It will use
the line definitions in this module to parse any input.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000134-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000134-source">
<pre>
    <span class="ruby-comment cmt"># File lib/request_log_analyzer/log_parser.rb, line 34</span>
34:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">format</span>, <span class="ruby-identifier">options</span> = {})      
35:       <span class="ruby-ivar">@line_definitions</span> = {}
36:       <span class="ruby-ivar">@options</span>          = <span class="ruby-identifier">options</span>
37:       <span class="ruby-ivar">@parsed_lines</span>     = <span class="ruby-value">0</span>
38:       <span class="ruby-ivar">@parsed_requests</span>  = <span class="ruby-value">0</span>
39:       <span class="ruby-ivar">@skipped_requests</span> = <span class="ruby-value">0</span>      
40:       
41:       <span class="ruby-ivar">@current_io</span> = <span class="ruby-keyword kw">nil</span>
42:       
43:       <span class="ruby-comment cmt"># install the file format module (see RequestLogAnalyzer::FileFormat)</span>
44:       <span class="ruby-comment cmt"># and register all the line definitions to the parser</span>
45:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">register_file_format</span>(<span class="ruby-identifier">format</span>)
46:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000136" class="method-detail">
        <a name="M000136"></a>

        <div class="method-heading">
          <a href="#M000136" class="method-signature">
          <span class="method-name">parse_file</span><span class="method-args">(file, options = {}, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Parses a file. Creates an IO stream for the provided file, and sends it to
<a href="LogParser.html#M000138">parse_io</a> for further handling
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000136-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000136-source">
<pre>
    <span class="ruby-comment cmt"># File lib/request_log_analyzer/log_parser.rb, line 55</span>
55:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse_file</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">options</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
56:       <span class="ruby-ivar">@progress_handler</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">:started</span>, <span class="ruby-identifier">file</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@progress_handler</span>
57:       <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">file</span>, <span class="ruby-value str">'r'</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">parse_io</span>(<span class="ruby-identifier">f</span>, <span class="ruby-identifier">options</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>) }
58:       <span class="ruby-ivar">@progress_handler</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">:finished</span>, <span class="ruby-identifier">file</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@progress_handler</span>
59:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000135" class="method-detail">
        <a name="M000135"></a>

        <div class="method-heading">
          <a href="#M000135" class="method-signature">
          <span class="method-name">parse_files</span><span class="method-args">(files, options = {}, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Parses a list of consequent files of the same format
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000135-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000135-source">
<pre>
    <span class="ruby-comment cmt"># File lib/request_log_analyzer/log_parser.rb, line 49</span>
49:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse_files</span>(<span class="ruby-identifier">files</span>, <span class="ruby-identifier">options</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
50:       <span class="ruby-identifier">files</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span> <span class="ruby-identifier">parse_file</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">options</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>) }
51:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000138" class="method-detail">
        <a name="M000138"></a>

        <div class="method-heading">
          <a href="#M000138" class="method-signature">
          <span class="method-name">parse_io</span><span class="method-args">(io, options = {}, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Finds a log line and then parses the information in the line. Yields a hash
containing the information found. <tt>*line_types</tt> The log line types
to look for (defaults to LOG_LINES.keys). Yeilds a Hash when it encounters
a chunk of information.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000138-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000138-source">
<pre>
    <span class="ruby-comment cmt"># File lib/request_log_analyzer/log_parser.rb, line 69</span>
69:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse_io</span>(<span class="ruby-identifier">io</span>, <span class="ruby-identifier">options</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
70: 
71:       <span class="ruby-comment cmt"># parse every line type by default</span>
72:       <span class="ruby-identifier">line_types</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:line_types</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">file_format</span>.<span class="ruby-identifier">line_definitions</span>.<span class="ruby-identifier">keys</span>
73: 
74:       <span class="ruby-comment cmt"># check whether all provided line types are valid</span>
75:       <span class="ruby-identifier">unknown</span> = <span class="ruby-identifier">line_types</span>.<span class="ruby-identifier">reject</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">line_type</span><span class="ruby-operator">|</span> <span class="ruby-identifier">file_format</span>.<span class="ruby-identifier">line_definitions</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">line_type</span>) }
76:       <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Unknown line types: #{unknown.join(', ')}&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">unknown</span>.<span class="ruby-identifier">empty?</span>
77:       
78:       <span class="ruby-ivar">@current_io</span> = <span class="ruby-identifier">io</span>
79:       <span class="ruby-ivar">@current_io</span>.<span class="ruby-identifier">each_line</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span>
80:         
81:         <span class="ruby-ivar">@progress_handler</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">:progress</span>, <span class="ruby-ivar">@current_io</span>.<span class="ruby-identifier">pos</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@progress_handler</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@current_io</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">File</span>)
82:         
83:         <span class="ruby-identifier">request_data</span> = <span class="ruby-keyword kw">nil</span>
84:         <span class="ruby-identifier">line_types</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">line_type</span><span class="ruby-operator">|</span>
85:           <span class="ruby-identifier">line_type_definition</span> = <span class="ruby-identifier">file_format</span>.<span class="ruby-identifier">line_definitions</span>[<span class="ruby-identifier">line_type</span>]
86:           <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">request_data</span> = <span class="ruby-identifier">line_type_definition</span>.<span class="ruby-identifier">matches</span>(<span class="ruby-identifier">line</span>, <span class="ruby-ivar">@current_io</span>.<span class="ruby-identifier">lineno</span>, <span class="ruby-keyword kw">self</span>)
87:         <span class="ruby-keyword kw">end</span>
88: 
89:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">request_data</span>
90:           <span class="ruby-ivar">@parsed_lines</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
91:           <span class="ruby-identifier">update_current_request</span>(<span class="ruby-identifier">request_data</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
92:         <span class="ruby-keyword kw">end</span>
93:       <span class="ruby-keyword kw">end</span>
94:       
95:       <span class="ruby-identifier">warn</span>(<span class="ruby-identifier">:unfinished_request_on_eof</span>, <span class="ruby-value str">&quot;End of file reached, but last request was not completed!&quot;</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@current_request</span>.<span class="ruby-identifier">nil?</span>
96:   
97:       <span class="ruby-ivar">@current_io</span> = <span class="ruby-keyword kw">nil</span>
98:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000137" class="method-detail">
        <a name="M000137"></a>

        <div class="method-heading">
          <a href="#M000137" class="method-signature">
          <span class="method-name">parse_stream</span><span class="method-args">(stream, options = {}, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000137-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000137-source">
<pre>
    <span class="ruby-comment cmt"># File lib/request_log_analyzer/log_parser.rb, line 61</span>
61:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse_stream</span>(<span class="ruby-identifier">stream</span>, <span class="ruby-identifier">options</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
62:       <span class="ruby-identifier">parse_io</span>(<span class="ruby-identifier">stream</span>, <span class="ruby-identifier">options</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
63:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000139" class="method-detail">
        <a name="M000139"></a>

        <div class="method-heading">
          <a href="#M000139" class="method-signature">
          <span class="method-name">progress=</span><span class="method-args">(proc)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Add a block to this method to install a progress handler while parsing
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000139-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000139-source">
<pre>
     <span class="ruby-comment cmt"># File lib/request_log_analyzer/log_parser.rb, line 101</span>
101:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">progress=</span>(<span class="ruby-identifier">proc</span>)
102:       <span class="ruby-ivar">@progress_handler</span> = <span class="ruby-identifier">proc</span>
103:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000141" class="method-detail">
        <a name="M000141"></a>

        <div class="method-heading">
          <a href="#M000141" class="method-signature">
          <span class="method-name">warn</span><span class="method-args">(type, message)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This method is called by the parser if it encounteres any problems. It will
call the warning handler. The default controller will pass all warnings to
every aggregator that is registered and running
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000141-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000141-source">
<pre>
     <span class="ruby-comment cmt"># File lib/request_log_analyzer/log_parser.rb, line 113</span>
113:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">warn</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">message</span>)
114:       <span class="ruby-ivar">@warning_handler</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">message</span>, <span class="ruby-ivar">@current_io</span>.<span class="ruby-identifier">lineno</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@warning_handler</span>
115:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000140" class="method-detail">
        <a name="M000140"></a>

        <div class="method-heading">
          <a href="#M000140" class="method-signature">
          <span class="method-name">warning=</span><span class="method-args">(proc)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Add a block to this method to install a warning handler while parsing
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000140-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000140-source">
<pre>
     <span class="ruby-comment cmt"># File lib/request_log_analyzer/log_parser.rb, line 106</span>
106:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">warning=</span>(<span class="ruby-identifier">proc</span>)
107:       <span class="ruby-ivar">@warning_handler</span> = <span class="ruby-identifier">proc</span>
108:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Protected Instance methods</h3>

      <div id="method-M000145" class="method-detail">
        <a name="M000145"></a>

        <div class="method-heading">
          <a href="#M000145" class="method-signature">
          <span class="method-name">footer_line?</span><span class="method-args">(hash)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Checks whether a given line hash is a footer line.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000145-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000145-source">
<pre>
     <span class="ruby-comment cmt"># File lib/request_log_analyzer/log_parser.rb, line 169</span>
169:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">footer_line?</span>(<span class="ruby-identifier">hash</span>)
170:       <span class="ruby-identifier">file_format</span>.<span class="ruby-identifier">line_definitions</span>[<span class="ruby-identifier">hash</span>[<span class="ruby-identifier">:line_type</span>]].<span class="ruby-identifier">footer</span>  
171:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000143" class="method-detail">
        <a name="M000143"></a>

        <div class="method-heading">
          <a href="#M000143" class="method-signature">
          <span class="method-name">handle_request</span><span class="method-args">(request) {|request| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Handles the parsed request by calling the request handler. The default
controller will send the request to every running aggegator.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000143-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000143-source">
<pre>
     <span class="ruby-comment cmt"># File lib/request_log_analyzer/log_parser.rb, line 157</span>
157:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">handle_request</span>(<span class="ruby-identifier">request</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
158:       <span class="ruby-ivar">@parsed_requests</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
159:       <span class="ruby-identifier">accepted</span> = <span class="ruby-identifier">block_given?</span> <span class="ruby-value">? </span><span class="ruby-keyword kw">yield</span>(<span class="ruby-identifier">request</span>) <span class="ruby-operator">:</span> <span class="ruby-keyword kw">true</span>
160:       <span class="ruby-ivar">@skipped_requests</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">accepted</span>
161:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000144" class="method-detail">
        <a name="M000144"></a>

        <div class="method-heading">
          <a href="#M000144" class="method-signature">
          <span class="method-name">header_line?</span><span class="method-args">(hash)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Checks whether a given line hash is a header line.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000144-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000144-source">
<pre>
     <span class="ruby-comment cmt"># File lib/request_log_analyzer/log_parser.rb, line 164</span>
164:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">header_line?</span>(<span class="ruby-identifier">hash</span>)
165:       <span class="ruby-identifier">file_format</span>.<span class="ruby-identifier">line_definitions</span>[<span class="ruby-identifier">hash</span>[<span class="ruby-identifier">:line_type</span>]].<span class="ruby-identifier">header</span>
166:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000142" class="method-detail">
        <a name="M000142"></a>

        <div class="method-heading">
          <a href="#M000142" class="method-signature">
          <span class="method-name">update_current_request</span><span class="method-args">(request_data, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Combines the different lines of a request into a single <a
href="Request.html">Request</a> object. It will start a <a
href="LogParser.html#M000134">new</a> request when a header line is
encountered en will emit the request when a footer line is encountered.
</p>
<ul>
<li>Every line that is parsed before a header line is ignored as it cannot be
included in any request. It will emit a :no_current_request warning.

</li>
<li>A header line that is parsed before a request is closed by a footer line,
is a sign of an unprpertly ordered file. All data that is gathered for the
request until then is discarded, the next request is ignored as well and a
:unclosed_request warning is emitted.

</li>
</ul>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000142-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000142-source">
<pre>
     <span class="ruby-comment cmt"># File lib/request_log_analyzer/log_parser.rb, line 129</span>
129:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_current_request</span>(<span class="ruby-identifier">request_data</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
130:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">header_line?</span>(<span class="ruby-identifier">request_data</span>)
131:         <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@current_request</span>.<span class="ruby-identifier">nil?</span>
132:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:assume_correct_order</span>]
133:             <span class="ruby-identifier">handle_request</span>(<span class="ruby-ivar">@current_request</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)            
134:             <span class="ruby-ivar">@current_request</span> = <span class="ruby-constant">RequestLogAnalyzer</span><span class="ruby-operator">::</span><span class="ruby-constant">Request</span>.<span class="ruby-identifier">create</span>(<span class="ruby-ivar">@file_format</span>, <span class="ruby-identifier">request_data</span>)
135:           <span class="ruby-keyword kw">else</span>
136:             <span class="ruby-identifier">warn</span>(<span class="ruby-identifier">:unclosed_request</span>, <span class="ruby-value str">&quot;Encountered header line, but previous request was not closed!&quot;</span>)
137:             <span class="ruby-ivar">@current_request</span> = <span class="ruby-keyword kw">nil</span> <span class="ruby-comment cmt"># remove all data that was parsed, skip next request as well.</span>
138:           <span class="ruby-keyword kw">end</span>
139:         <span class="ruby-keyword kw">else</span>
140:           <span class="ruby-ivar">@current_request</span> = <span class="ruby-constant">RequestLogAnalyzer</span><span class="ruby-operator">::</span><span class="ruby-constant">Request</span>.<span class="ruby-identifier">create</span>(<span class="ruby-ivar">@file_format</span>, <span class="ruby-identifier">request_data</span>)              
141:         <span class="ruby-keyword kw">end</span>
142:       <span class="ruby-keyword kw">else</span>
143:         <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@current_request</span>.<span class="ruby-identifier">nil?</span>
144:           <span class="ruby-ivar">@current_request</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">request_data</span>
145:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">footer_line?</span>(<span class="ruby-identifier">request_data</span>)
146:             <span class="ruby-identifier">handle_request</span>(<span class="ruby-ivar">@current_request</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
147:             <span class="ruby-ivar">@current_request</span> = <span class="ruby-keyword kw">nil</span> 
148:           <span class="ruby-keyword kw">end</span>
149:         <span class="ruby-keyword kw">else</span>
150:           <span class="ruby-identifier">warn</span>(<span class="ruby-identifier">:no_current_request</span>, <span class="ruby-value str">&quot;Parsebale line found outside of a request!&quot;</span>)
151:         <span class="ruby-keyword kw">end</span>
152:       <span class="ruby-keyword kw">end</span>
153:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>