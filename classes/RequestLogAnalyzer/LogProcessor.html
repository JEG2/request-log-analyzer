<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: RequestLogAnalyzer::LogProcessor</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">RequestLogAnalyzer::LogProcessor</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../files/lib/request_log_analyzer/log_processor_rb.html">
                lib/request_log_analyzer/log_processor.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
The Logprocessor class is used to perform simple processing actions over
log files. It will go over the log file/stream line by line, pass the line
to a processor and write the result back to the output file or stream. The
processor can alter the contents of the line, remain it intact or remove it
altogether, based on the current file format
</p>
<p>
Currently, one processors is supported:
</p>
<pre>
 * :strip will remove all irrelevent lines (according to the file format) from the
   sources. A compact, information packed log will remain/.
</pre>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000189">build</a>&nbsp;&nbsp;
      <a href="#M000190">new</a>&nbsp;&nbsp;
      <a href="#M000191">process_file</a>&nbsp;&nbsp;
      <a href="#M000192">process_io</a>&nbsp;&nbsp;
      <a href="#M000194">run!</a>&nbsp;&nbsp;
      <a href="#M000193">strip_line</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->
    <div id="includes">
      <h3 class="section-bar">Included Modules</h3>

      <div id="includes-list">
        <span class="include-name"><a href="FileFormat/Awareness.html">RequestLogAnalyzer::FileFormat::Awareness</a></span>
      </div>
    </div>

    <div id="section">





    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">mode</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">options</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">output_file</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">sources</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000189" class="method-detail">
        <a name="M000189"></a>

        <div class="method-heading">
          <a href="#M000189" class="method-signature">
          <span class="method-name">build</span><span class="method-args">(command, arguments)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Builds a logprocessor instance from the arguments given on the command line
<tt>command</tt> The command hat was used to start the log processor. This
will set the
</p>
<pre>
   processing mode. Currently, only :strip is supported.
</pre>
<p>
<tt>arguments</tt> The parsed command line arguments (a <a
href="../CommandLine/Arguments.html">CommandLine::Arguments</a> instance)
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000189-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000189-source">
<pre>
    <span class="ruby-comment cmt"># File lib/request_log_analyzer/log_processor.rb, line 24</span>
24:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">build</span>(<span class="ruby-identifier">command</span>, <span class="ruby-identifier">arguments</span>)
25:       
26:       <span class="ruby-identifier">options</span> = { 
27:           <span class="ruby-identifier">:discard_teaser_lines</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">arguments</span>[<span class="ruby-identifier">:discard_teaser_lines</span>], 
28:           <span class="ruby-identifier">:keep_junk_lines</span>      =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">arguments</span>[<span class="ruby-identifier">:keep_junk_lines</span>], 
29:         }
30:           
31:       <span class="ruby-identifier">log_processor</span> = <span class="ruby-constant">RequestLogAnalyzer</span><span class="ruby-operator">::</span><span class="ruby-constant">LogProcessor</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">arguments</span>[<span class="ruby-identifier">:format</span>].<span class="ruby-identifier">to_sym</span>, <span class="ruby-identifier">command</span>, <span class="ruby-identifier">options</span>)
32:       <span class="ruby-identifier">log_processor</span>.<span class="ruby-identifier">output_file</span> = <span class="ruby-identifier">arguments</span>[<span class="ruby-identifier">:output</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">arguments</span>[<span class="ruby-identifier">:output</span>]
33: 
34:       <span class="ruby-identifier">arguments</span>.<span class="ruby-identifier">parameters</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">input</span><span class="ruby-operator">|</span>
35:         <span class="ruby-identifier">log_processor</span>.<span class="ruby-identifier">sources</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">input</span>
36:       <span class="ruby-keyword kw">end</span>
37:       
38:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">log_processor</span>
39:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000190" class="method-detail">
        <a name="M000190"></a>

        <div class="method-heading">
          <a href="#M000190" class="method-signature">
          <span class="method-name">new</span><span class="method-args">(format, mode, options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Initializes a <a href="LogProcessor.html#M000190">new</a> <a
href="LogProcessor.html">LogProcessor</a> instance. <tt>format</tt> The
file format to use (e.g. :rails). <tt>mode</tt> The processing mode
<tt>options</tt> A hash with options to take into account
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000190-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000190-source">
<pre>
    <span class="ruby-comment cmt"># File lib/request_log_analyzer/log_processor.rb, line 45</span>
45:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">format</span>, <span class="ruby-identifier">mode</span>, <span class="ruby-identifier">options</span> = {})
46:       <span class="ruby-ivar">@options</span> = <span class="ruby-identifier">options</span>
47:       <span class="ruby-ivar">@mode</span>    = <span class="ruby-identifier">mode</span>
48:       <span class="ruby-ivar">@sources</span> = []
49:       <span class="ruby-identifier">$output_file</span> = <span class="ruby-keyword kw">nil</span>
50:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">register_file_format</span>(<span class="ruby-identifier">format</span>)
51:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000191" class="method-detail">
        <a name="M000191"></a>

        <div class="method-heading">
          <a href="#M000191" class="method-signature">
          <span class="method-name">process_file</span><span class="method-args">(file)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Processes input files by opening it and sending the filestream to <tt><a
href="LogProcessor.html#M000192">process_io</a></tt>, in which the actual
processing is performed. <tt>file</tt> The file to process
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000191-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000191-source">
<pre>
    <span class="ruby-comment cmt"># File lib/request_log_analyzer/log_processor.rb, line 56</span>
56:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">process_file</span>(<span class="ruby-identifier">file</span>)
57:       <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">file</span>, <span class="ruby-value str">'r'</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span> <span class="ruby-identifier">process_io</span>(<span class="ruby-identifier">file</span>) }
58:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000192" class="method-detail">
        <a name="M000192"></a>

        <div class="method-heading">
          <a href="#M000192" class="method-signature">
          <span class="method-name">process_io</span><span class="method-args">(io)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Processes an input stream by iteration over each line and processing it
according to the current operation mode <tt>io</tt> The IO instance to
process.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000192-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000192-source">
<pre>
    <span class="ruby-comment cmt"># File lib/request_log_analyzer/log_processor.rb, line 63</span>
63:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">process_io</span>(<span class="ruby-identifier">io</span>)
64:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">mode</span>
65:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:strip</span>;     <span class="ruby-identifier">io</span>.<span class="ruby-identifier">each_line</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@output</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">strip_line</span>(<span class="ruby-identifier">line</span>) }
66:       <span class="ruby-keyword kw">end</span>
67:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000194" class="method-detail">
        <a name="M000194"></a>

        <div class="method-heading">
          <a href="#M000194" class="method-signature">
          <span class="method-name">run!</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Runs the log processing by setting up the output stream and iterating over
all the input sources. Input sources can either be filenames (String
instances) or IO streams (IO instances). The strings &quot;-&quot; and
&quot;STDIN&quot; will be substituted for the $stdin variable.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000194-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000194-source">
<pre>
    <span class="ruby-comment cmt"># File lib/request_log_analyzer/log_processor.rb, line 79</span>
79:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">run!</span>
80:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@output_file</span>.<span class="ruby-identifier">nil?</span>
81:         <span class="ruby-ivar">@output</span> = <span class="ruby-identifier">$stdout</span> 
82:       <span class="ruby-keyword kw">else</span>
83:         <span class="ruby-ivar">@output</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@output_file</span>, <span class="ruby-value str">'a'</span>)        
84:       <span class="ruby-keyword kw">end</span>
85:       
86:       <span class="ruby-ivar">@sources</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">source</span><span class="ruby-operator">|</span>
87:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">source</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">String</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">source</span>)
88:           <span class="ruby-identifier">process_file</span>(<span class="ruby-identifier">source</span>)
89:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">source</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">IO</span>)
90:           <span class="ruby-identifier">process_io</span>(<span class="ruby-identifier">source</span>)
91:         <span class="ruby-keyword kw">elsif</span> [<span class="ruby-value str">'-'</span>, <span class="ruby-value str">'STDIN'</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">source</span>)
92:           <span class="ruby-identifier">process_io</span>(<span class="ruby-identifier">$stdin</span>)        
93:         <span class="ruby-keyword kw">end</span>
94:       <span class="ruby-keyword kw">end</span>
95:     
96:     <span class="ruby-keyword kw">ensure</span>
97:       <span class="ruby-ivar">@output</span>.<span class="ruby-identifier">close</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@output</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">File</span>)
98:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000193" class="method-detail">
        <a name="M000193"></a>

        <div class="method-heading">
          <a href="#M000193" class="method-signature">
          <span class="method-name">strip_line</span><span class="method-args">(line)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the line itself if the string matches any of the line definitions.
If no match is found, an empty line is returned, which will strip the line
from the output. <tt>line</tt> The line to strip
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000193-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000193-source">
<pre>
    <span class="ruby-comment cmt"># File lib/request_log_analyzer/log_processor.rb, line 72</span>
72:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">strip_line</span>(<span class="ruby-identifier">line</span>)
73:       <span class="ruby-identifier">file_format</span>.<span class="ruby-identifier">line_definitions</span>.<span class="ruby-identifier">any?</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">definition</span><span class="ruby-operator">|</span> <span class="ruby-identifier">definition</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">line</span> } <span class="ruby-operator">?</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">:</span> <span class="ruby-value str">&quot;&quot;</span>
74:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>