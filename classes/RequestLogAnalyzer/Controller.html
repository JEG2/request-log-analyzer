<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: RequestLogAnalyzer::Controller</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">RequestLogAnalyzer::Controller</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../files/lib/request_log_analyzer/controller_rb.html">
                lib/request_log_analyzer/controller.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
The <a href="Controller.html">RequestLogAnalyzer::Controller</a> class
creates a LogParser instance for the requested file format, and connect it
with sources and aggregators.
</p>
<p>
Sources are streams or files from which the requests will be parsed.
Aggregators will handle every passed request to yield a meaningfull
results.
</p>
<ul>
<li>Use the <a href="Controller.html#M000146">build</a>-function to <a
href="Controller.html#M000146">build</a> a controller instance using
command line arguments.

</li>
<li>Use <a href="Controller.html#M000149">add_aggregator</a> to register a <a
href="Controller.html#M000147">new</a> aggregator

</li>
<li>Use add_source to register a <a href="Controller.html#M000147">new</a>
aggregator

</li>
<li>Use the <a href="Controller.html#M000152">run!</a> method to start the
parser and send the requests to the aggregators.

</li>
</ul>
<p>
Note that the order of sources can be imported if you have log files than
succeed eachother. Requests that span over succeeding files will be parsed
correctly if the sources are registered in the correct order. This can be
helpful to parse requests from several logrotated log files.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000150">&gt;&gt;</a>&nbsp;&nbsp;
      <a href="#M000149">add_aggregator</a>&nbsp;&nbsp;
      <a href="#M000151">add_filter</a>&nbsp;&nbsp;
      <a href="#M000146">build</a>&nbsp;&nbsp;
      <a href="#M000148">handle_progress</a>&nbsp;&nbsp;
      <a href="#M000147">new</a>&nbsp;&nbsp;
      <a href="#M000152">run!</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->
    <div id="includes">
      <h3 class="section-bar">Included Modules</h3>

      <div id="includes-list">
        <span class="include-name"><a href="FileFormat/Awareness.html">RequestLogAnalyzer::FileFormat::Awareness</a></span>
      </div>
    </div>

    <div id="section">





    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">aggregators</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">filters</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">log_parser</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">options</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">output</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">source</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000146" class="method-detail">
        <a name="M000146"></a>

        <div class="method-heading">
          <a href="#M000146" class="method-signature">
          <span class="method-name">build</span><span class="method-args">(arguments)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Builds a <a href="Controller.html">RequestLogAnalyzer::Controller</a> given
parsed command line arguments <tt>arguments&lt;tt&gt; A <a
href="../CommandLine/Arguments.html">CommandLine::Arguments</a> hash
containing parsed commandline parameters. &lt;rr&gt;report_with</tt> Width
of the report. Defaults to 80.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000146-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000146-source">
<pre>
    <span class="ruby-comment cmt"># File lib/request_log_analyzer/controller.rb, line 32</span>
32:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">build</span>(<span class="ruby-identifier">arguments</span>)
33:       <span class="ruby-identifier">options</span> = { }
34: 
35:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:database</span>] = <span class="ruby-identifier">arguments</span>[<span class="ruby-identifier">:database</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">arguments</span>[<span class="ruby-identifier">:database</span>]
36:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:debug</span>]    = <span class="ruby-identifier">arguments</span>[<span class="ruby-identifier">:debug</span>]
37: 
38:       <span class="ruby-identifier">output_class</span> = <span class="ruby-constant">RequestLogAnalyzer</span><span class="ruby-operator">::</span><span class="ruby-constant">Output</span><span class="ruby-operator">::</span><span class="ruby-identifier">const_get</span>(<span class="ruby-identifier">arguments</span>[<span class="ruby-identifier">:output</span>])
39:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">arguments</span>[<span class="ruby-identifier">:file</span>]
40:         <span class="ruby-identifier">output_file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">arguments</span>[<span class="ruby-identifier">:file</span>], <span class="ruby-value str">&quot;w+&quot;</span>)
41:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:output</span>] = <span class="ruby-identifier">output_class</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">output_file</span>, <span class="ruby-identifier">:width</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">80</span>, <span class="ruby-identifier">:color</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>, <span class="ruby-identifier">:characters</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:ascii</span>)
42:       <span class="ruby-keyword kw">else</span>
43:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:output</span>] = <span class="ruby-identifier">output_class</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">STDOUT</span>, <span class="ruby-identifier">:width</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">arguments</span>[<span class="ruby-identifier">:report_width</span>].<span class="ruby-identifier">to_i</span>, 
44:             <span class="ruby-identifier">:color</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">arguments</span>[<span class="ruby-identifier">:boring</span>], <span class="ruby-identifier">:characters</span> =<span class="ruby-operator">&gt;</span> (<span class="ruby-identifier">arguments</span>[<span class="ruby-identifier">:boring</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">:ascii</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">:utf</span>))
45:       <span class="ruby-keyword kw">end</span>
46:                 
47:       <span class="ruby-comment cmt"># Create the controller with the correct file format</span>
48:       <span class="ruby-identifier">file_format</span> = <span class="ruby-constant">RequestLogAnalyzer</span><span class="ruby-operator">::</span><span class="ruby-constant">FileFormat</span>.<span class="ruby-identifier">load</span>(<span class="ruby-identifier">arguments</span>[<span class="ruby-identifier">:format</span>])
49: 
50:       <span class="ruby-comment cmt"># register sources</span>
51:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">arguments</span>.<span class="ruby-identifier">parameters</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
52:         <span class="ruby-identifier">file</span> = <span class="ruby-identifier">arguments</span>.<span class="ruby-identifier">parameters</span>[<span class="ruby-value">0</span>]
53:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">file</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'-'</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">file</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'STDIN'</span>
54:           <span class="ruby-identifier">options</span>.<span class="ruby-identifier">store</span>(<span class="ruby-identifier">:source_files</span>, <span class="ruby-identifier">$stdin</span>)
55:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">file</span>)
56:           <span class="ruby-identifier">options</span>.<span class="ruby-identifier">store</span>(<span class="ruby-identifier">:source_files</span>, <span class="ruby-identifier">file</span>)
57:         <span class="ruby-keyword kw">else</span>
58:           <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;File not found: #{file}&quot;</span>
59:           <span class="ruby-identifier">exit</span>(<span class="ruby-value">0</span>)
60:         <span class="ruby-keyword kw">end</span>
61:       <span class="ruby-keyword kw">else</span>
62:         <span class="ruby-identifier">options</span>.<span class="ruby-identifier">store</span>(<span class="ruby-identifier">:source_files</span>, <span class="ruby-identifier">arguments</span>.<span class="ruby-identifier">parameters</span>)
63:       <span class="ruby-keyword kw">end</span>
64:       
65:       <span class="ruby-identifier">controller</span> = <span class="ruby-constant">Controller</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">RequestLogAnalyzer</span><span class="ruby-operator">::</span><span class="ruby-constant">Source</span><span class="ruby-operator">::</span><span class="ruby-constant">LogParser</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">file_format</span>, <span class="ruby-identifier">options</span>), <span class="ruby-identifier">options</span>)
66: 
67:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:assume_correct_order</span>] = <span class="ruby-identifier">arguments</span>[<span class="ruby-identifier">:assume_correct_order</span>]
68:       
69:       <span class="ruby-comment cmt"># register filters        </span>
70:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">arguments</span>[<span class="ruby-identifier">:after</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">arguments</span>[<span class="ruby-identifier">:before</span>]
71:         <span class="ruby-identifier">filter_options</span> = {}
72:         <span class="ruby-identifier">filter_options</span>[<span class="ruby-identifier">:after</span>]  = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">arguments</span>[<span class="ruby-identifier">:after</span>])  
73:         <span class="ruby-identifier">filter_options</span>[<span class="ruby-identifier">:before</span>] = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">arguments</span>[<span class="ruby-identifier">:before</span>]) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">arguments</span>[<span class="ruby-identifier">:before</span>]
74:         <span class="ruby-identifier">controller</span>.<span class="ruby-identifier">add_filter</span>(<span class="ruby-identifier">:timespan</span>, <span class="ruby-identifier">filter_options</span>)
75:       <span class="ruby-keyword kw">end</span>
76:       
77:       <span class="ruby-identifier">arguments</span>[<span class="ruby-identifier">:reject</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span>(<span class="ruby-identifier">field</span>, <span class="ruby-identifier">value</span>)<span class="ruby-operator">|</span>
78:         <span class="ruby-identifier">controller</span>.<span class="ruby-identifier">add_filter</span>(<span class="ruby-identifier">:field</span>, <span class="ruby-identifier">:mode</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:reject</span>, <span class="ruby-identifier">:field</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">field</span>, <span class="ruby-identifier">:value</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">value</span>)
79:       <span class="ruby-keyword kw">end</span>
80:       
81:       <span class="ruby-identifier">arguments</span>[<span class="ruby-identifier">:select</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span>(<span class="ruby-identifier">field</span>, <span class="ruby-identifier">value</span>)<span class="ruby-operator">|</span>
82:         <span class="ruby-identifier">controller</span>.<span class="ruby-identifier">add_filter</span>(<span class="ruby-identifier">:field</span>, <span class="ruby-identifier">:mode</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:select</span>, <span class="ruby-identifier">:field</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">field</span>, <span class="ruby-identifier">:value</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">value</span>)
83:       <span class="ruby-keyword kw">end</span>
84: 
85:       <span class="ruby-comment cmt"># register aggregators</span>
86:       <span class="ruby-identifier">arguments</span>[<span class="ruby-identifier">:aggregator</span>].<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">agg</span><span class="ruby-operator">|</span> <span class="ruby-identifier">controller</span>.<span class="ruby-identifier">add_aggregator</span>(<span class="ruby-identifier">agg</span>.<span class="ruby-identifier">to_sym</span>) }
87: 
88:       <span class="ruby-comment cmt"># register the database </span>
89:       <span class="ruby-identifier">controller</span>.<span class="ruby-identifier">add_aggregator</span>(<span class="ruby-identifier">:database</span>)   <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">arguments</span>[<span class="ruby-identifier">:database</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">arguments</span>[<span class="ruby-identifier">:aggregator</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-value str">'database'</span>)
90:       <span class="ruby-identifier">controller</span>.<span class="ruby-identifier">add_aggregator</span>(<span class="ruby-identifier">:summarizer</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">arguments</span>[<span class="ruby-identifier">:aggregator</span>].<span class="ruby-identifier">empty?</span>
91:     
92:       <span class="ruby-comment cmt"># register the echo aggregator in debug mode</span>
93:       <span class="ruby-identifier">controller</span>.<span class="ruby-identifier">add_aggregator</span>(<span class="ruby-identifier">:echo</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">arguments</span>[<span class="ruby-identifier">:debug</span>]
94:       
95:       <span class="ruby-identifier">file_format</span>.<span class="ruby-identifier">setup_environment</span>(<span class="ruby-identifier">controller</span>)
96:           
97:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">controller</span>
98:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000147" class="method-detail">
        <a name="M000147"></a>

        <div class="method-heading">
          <a href="#M000147" class="method-signature">
          <span class="method-name">new</span><span class="method-args">(source, options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Builds a <a href="Controller.html#M000147">new</a> <a
href="Controller.html">Controller</a> for the given log file format.
<tt>format</tt> Logfile format. Defaults to :rails Options are passd on to
the LogParser.
</p>
<ul>
<li><tt>:aggregator</tt> <a href="Aggregator.html">Aggregator</a> array.

</li>
<li><tt>:database</tt> Database the controller should use.

</li>
<li><tt>:echo</tt> <a href="Output.html">Output</a> debug information.

</li>
<li><tt>:silent</tt> Do not output any warnings.

</li>
<li><tt>:colorize</tt> Colorize output

</li>
<li><tt>:output</tt> All report outputs get &lt;&lt; through this output.

</li>
</ul>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000147-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000147-source">
<pre>
     <span class="ruby-comment cmt"># File lib/request_log_analyzer/controller.rb, line 109</span>
109:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">options</span> = {})
110: 
111:       <span class="ruby-ivar">@source</span>      = <span class="ruby-identifier">source</span>
112:       <span class="ruby-ivar">@options</span>     = <span class="ruby-identifier">options</span>
113:       <span class="ruby-ivar">@aggregators</span> = []
114:       <span class="ruby-ivar">@filters</span>     = []
115:       <span class="ruby-ivar">@output</span>      = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:output</span>]
116:       
117:       <span class="ruby-comment cmt"># Requester format through RequestLogAnalyzer::FileFormat and construct the parser</span>
118:       <span class="ruby-identifier">register_file_format</span>(<span class="ruby-ivar">@source</span>.<span class="ruby-identifier">file_format</span>) 
119:       
120:       <span class="ruby-comment cmt"># Pass all warnings to every aggregator so they can do something useful with them.</span>
121:       <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">warning</span> = <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">type</span>, <span class="ruby-identifier">message</span>, <span class="ruby-identifier">lineno</span><span class="ruby-operator">|</span>  <span class="ruby-ivar">@aggregators</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">agg</span><span class="ruby-operator">|</span> <span class="ruby-identifier">agg</span>.<span class="ruby-identifier">warning</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">message</span>, <span class="ruby-identifier">lineno</span>) } } <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@source</span>
122: 
123:       <span class="ruby-comment cmt"># Handle progress messagess</span>
124:       <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">progress</span> = <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">message</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span> <span class="ruby-identifier">handle_progress</span>(<span class="ruby-identifier">message</span>, <span class="ruby-identifier">value</span>) } <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@source</span>
125:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000150" class="method-detail">
        <a name="M000150"></a>

        <div class="method-heading">
          <span class="method-name">&gt;&gt;</span><span class="method-args">(agg)</span>
        </div>
      
        <div class="method-description">
          <p>
Alias for <a href="Controller.html#M000149">add_aggregator</a>
</p>
        </div>
      </div>

      <div id="method-M000149" class="method-detail">
        <a name="M000149"></a>

        <div class="method-heading">
          <a href="#M000149" class="method-signature">
          <span class="method-name">add_aggregator</span><span class="method-args">(agg)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Adds an aggregator to the controller. The aggregator will be called for
every request that is parsed from the provided sources (see add_source)
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000149-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000149-source">
<pre>
     <span class="ruby-comment cmt"># File lib/request_log_analyzer/controller.rb, line 150</span>
150:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_aggregator</span>(<span class="ruby-identifier">agg</span>)      
151:       <span class="ruby-identifier">agg</span> = <span class="ruby-constant">RequestLogAnalyzer</span><span class="ruby-operator">::</span><span class="ruby-constant">Aggregator</span>.<span class="ruby-identifier">const_get</span>(<span class="ruby-constant">RequestLogAnalyzer</span><span class="ruby-operator">::</span><span class="ruby-identifier">to_camelcase</span>(<span class="ruby-identifier">agg</span>)) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">agg</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Symbol</span>)
152:       <span class="ruby-ivar">@aggregators</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">agg</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@source</span>, <span class="ruby-ivar">@options</span>)
153:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000151" class="method-detail">
        <a name="M000151"></a>

        <div class="method-heading">
          <a href="#M000151" class="method-signature">
          <span class="method-name">add_filter</span><span class="method-args">(filter, filter_options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Adds a request filter to the controller.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000151-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000151-source">
<pre>
     <span class="ruby-comment cmt"># File lib/request_log_analyzer/controller.rb, line 158</span>
158:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_filter</span>(<span class="ruby-identifier">filter</span>, <span class="ruby-identifier">filter_options</span> = {})
159:       <span class="ruby-identifier">filter</span> = <span class="ruby-constant">RequestLogAnalyzer</span><span class="ruby-operator">::</span><span class="ruby-constant">Filter</span>.<span class="ruby-identifier">const_get</span>(<span class="ruby-constant">RequestLogAnalyzer</span><span class="ruby-operator">::</span><span class="ruby-identifier">to_camelcase</span>(<span class="ruby-identifier">filter</span>)) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">filter</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Symbol</span>)
160:       <span class="ruby-ivar">@filters</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">filter</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">file_format</span>, <span class="ruby-ivar">@options</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">filter_options</span>))
161:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000148" class="method-detail">
        <a name="M000148"></a>

        <div class="method-heading">
          <a href="#M000148" class="method-signature">
          <span class="method-name">handle_progress</span><span class="method-args">(message, value = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Progress function. Expects :started with file, :progress with current line
and :finished or :interrupted when done. <tt>message</tt> Current state
(:started, :finished, :interupted or :progress). <tt>value</tt> File or
current line.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000148-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000148-source">
<pre>
     <span class="ruby-comment cmt"># File lib/request_log_analyzer/controller.rb, line 131</span>
131:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">handle_progress</span>(<span class="ruby-identifier">message</span>, <span class="ruby-identifier">value</span> = <span class="ruby-keyword kw">nil</span>)
132:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">message</span>
133:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:started</span>
134:         <span class="ruby-ivar">@progress_bar</span> = <span class="ruby-constant">CommandLine</span><span class="ruby-operator">::</span><span class="ruby-constant">ProgressBar</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">value</span>), <span class="ruby-constant">File</span>.<span class="ruby-identifier">size</span>(<span class="ruby-identifier">value</span>))
135:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:finished</span>
136:         <span class="ruby-ivar">@progress_bar</span>.<span class="ruby-identifier">finish</span>
137:         <span class="ruby-ivar">@progress_bar</span> = <span class="ruby-keyword kw">nil</span>
138:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:interrupted</span>
139:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@progress_bar</span>
140:           <span class="ruby-ivar">@progress_bar</span>.<span class="ruby-identifier">halt</span>
141:           <span class="ruby-ivar">@progress_bar</span> = <span class="ruby-keyword kw">nil</span>
142:         <span class="ruby-keyword kw">end</span>
143:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:progress</span>
144:         <span class="ruby-ivar">@progress_bar</span>.<span class="ruby-identifier">set</span>(<span class="ruby-identifier">value</span>)
145:       <span class="ruby-keyword kw">end</span>
146:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000152" class="method-detail">
        <a name="M000152"></a>

        <div class="method-heading">
          <a href="#M000152" class="method-signature">
          <span class="method-name">run!</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Runs <a href="../RequestLogAnalyzer.html">RequestLogAnalyzer</a>
</p>
<ol>
<li>Call prepare on every aggregator

</li>
<li>Generate requests from source object

</li>
<li><a href="Filter.html">Filter</a> out unwanted requests

</li>
<li>Call aggregate for remaning requests on every aggregator

</li>
<li>Call finalize on every aggregator

</li>
<li>Call report on every aggregator

</li>
<li>Finalize <a href="Source.html">Source</a>

</li>
</ol>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000152-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000152-source">
<pre>
     <span class="ruby-comment cmt"># File lib/request_log_analyzer/controller.rb, line 171</span>
171:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">run!</span>
172:       
173:       <span class="ruby-ivar">@filters</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">filter</span><span class="ruby-operator">|</span> <span class="ruby-identifier">filter</span>.<span class="ruby-identifier">prepare</span> }
174:       <span class="ruby-ivar">@aggregators</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">agg</span><span class="ruby-operator">|</span> <span class="ruby-identifier">agg</span>.<span class="ruby-identifier">prepare</span> }
175:       
176:       <span class="ruby-keyword kw">begin</span>
177:         <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">each_request</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">request</span><span class="ruby-operator">|</span>
178:           <span class="ruby-ivar">@filters</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">filter</span><span class="ruby-operator">|</span> <span class="ruby-identifier">request</span> = <span class="ruby-identifier">filter</span>.<span class="ruby-identifier">filter</span>(<span class="ruby-identifier">request</span>) }
179:           <span class="ruby-ivar">@aggregators</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">agg</span><span class="ruby-operator">|</span> <span class="ruby-identifier">agg</span>.<span class="ruby-identifier">aggregate</span>(<span class="ruby-identifier">request</span>) } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">request</span>
180:         <span class="ruby-keyword kw">end</span>
181:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Interrupt</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
182:         <span class="ruby-identifier">handle_progress</span>(<span class="ruby-identifier">:interrupted</span>)
183:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Caught interrupt! Stopped parsing.&quot;</span>
184:       <span class="ruby-keyword kw">end</span>
185: 
186:       <span class="ruby-ivar">@aggregators</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">agg</span><span class="ruby-operator">|</span> <span class="ruby-identifier">agg</span>.<span class="ruby-identifier">finalize</span> }
187: 
188:       <span class="ruby-ivar">@output</span>.<span class="ruby-identifier">header</span>
189:       <span class="ruby-ivar">@aggregators</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">agg</span><span class="ruby-operator">|</span> <span class="ruby-identifier">agg</span>.<span class="ruby-identifier">report</span>(<span class="ruby-ivar">@output</span>) }
190:       <span class="ruby-ivar">@output</span>.<span class="ruby-identifier">footer</span>
191:             
192:       <span class="ruby-ivar">@source</span>.<span class="ruby-identifier">finalize</span>
193:       
194:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@output</span>.<span class="ruby-identifier">io</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">File</span>)
195:         <span class="ruby-identifier">puts</span>
196:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Report written to: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-ivar">@output</span>.<span class="ruby-identifier">io</span>.<span class="ruby-identifier">path</span>)
197:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Thanks for using request-log-analyzer!&quot;</span>
198:         <span class="ruby-ivar">@output</span>.<span class="ruby-identifier">io</span>.<span class="ruby-identifier">close</span>
199:       <span class="ruby-keyword kw">end</span>
200:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>